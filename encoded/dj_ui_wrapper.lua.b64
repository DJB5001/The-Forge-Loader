-- dj_ui_wrapper.lua
-- Wraps Tab creation methods to auto-register UI elements with flags

local UIWrapper = {}

function UIWrapper.wrapTab(Tab)
    local OriginalCreateToggle = Tab.CreateToggle
    local OriginalCreateSlider = Tab.CreateSlider
    local OriginalCreateDropdown = Tab.CreateDropdown
    local OriginalCreateInput = Tab.CreateInput
    
    -- Wrap CreateToggle
    Tab.CreateToggle = function(self, config)
        local toggle = OriginalCreateToggle(self, config)
        if config.Flag and toggle then
            _G.registerUIElement(config.Flag, toggle, "Toggle")
        end
        return toggle
    end
    
    -- Wrap CreateSlider
    Tab.CreateSlider = function(self, config)
        local slider = OriginalCreateSlider(self, config)
        if config.Flag and slider then
            _G.registerUIElement(config.Flag, slider, "Slider")
        end
        return slider
    end
    
    -- Wrap CreateDropdown
    Tab.CreateDropdown = function(self, config)
        local dropdown = OriginalCreateDropdown(self, config)
        if config.Flag and dropdown then
            _G.registerUIElement(config.Flag, dropdown, "Dropdown")
        end
        return dropdown
    end
    
    -- Wrap CreateInput
    Tab.CreateInput = function(self, config)
        local input = OriginalCreateInput(self, config)
        if config.Flag and input then
            _G.registerUIElement(config.Flag, input, "Input")
        end
        return input
    end
    
    return Tab
end

function UIWrapper.wrapWindow(Window)
    local OriginalCreateTab = Window.CreateTab
    
    Window.CreateTab = function(self, name, icon)
        local tab = OriginalCreateTab(self, name, icon)
        return UIWrapper.wrapTab(tab)
    end
    
    return Window
end

return UIWrapper